# All-in-One å–®æª”æ¡ˆç‰ˆæœ¬ä½¿ç”¨æŒ‡å—

## ğŸ“¦ æª”æ¡ˆèªªæ˜

`all_in_one.py` æ˜¯ä¸€å€‹å®Œæ•´çš„å–®æª”æ¡ˆç‰ˆæœ¬ï¼ŒåŒ…å«ï¼š

âœ… **æ‰€æœ‰æ„Ÿæ‡‰å™¨é¡åˆ¥ï¼š**
- HeartRateMonitorï¼ˆå¿ƒç‡ç›£æ¸¬å™¨ï¼‰
- AD8232Sensorï¼ˆECG å¿ƒé›»åœ–ï¼‰
- GSRSensorï¼ˆçš®è†šé›»å°ï¼‰
- MyowareSensorï¼ˆEMG è‚Œé›»åœ–ï¼‰
- DHT22Sensorï¼ˆç’°å¢ƒæº«æ¿•åº¦ï¼‰
- MAX30205Sensorï¼ˆé«”æº«ï¼‰
- MAX30102Sensorï¼ˆå¿ƒç‡/è¡€æ°§ï¼‰

âœ… **SensorManagerï¼ˆæ„Ÿæ‡‰å™¨ç®¡ç†å™¨ï¼‰**
- å¤šé »ç‡ç³»çµ±
- è‡ªå‹•æ•¸æ“šæ”¶é›†
- JSON è¼¸å‡º

âœ… **é…ç½®å’Œä¸»ç¨‹å¼**
- è…³ä½å®šç¾©
- UART è¨­å®š
- ä¸»å¾ªç’°

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### æ–¹æ³• 1ï¼šä½¿ç”¨ Thonny IDEï¼ˆæ¨è–¦ï¼‰

1. **æ‰“é–‹ Thonny**
   - é€£æ¥ Pico W åˆ°é›»è…¦
   - ç¢ºä¿ Thonny å·²é¸æ“‡æ­£ç¢ºçš„ MicroPython è§£é‡‹å™¨

2. **æ‰“é–‹æª”æ¡ˆ**
   - åœ¨ Thonny ä¸­æ‰“é–‹ `all_in_one.py`

3. **ä¸Šå‚³åˆ° Pico W**
   - æŒ‰ `Ctrl+S` æˆ–é»æ“Šã€Œå„²å­˜ã€
   - é¸æ“‡ã€Œ**MicroPython è£ç½®**ã€
   - å°‡æª”æ¡ˆå‘½åç‚º `main.py`ï¼ˆæœƒè‡ªå‹•åŸ·è¡Œï¼‰æˆ–å…¶ä»–åç¨±

4. **åŸ·è¡Œ**
   - å¦‚æœå‘½åç‚º `main.py`ï¼šé‡æ–°å•Ÿå‹• Pico W å³å¯è‡ªå‹•åŸ·è¡Œ
   - å¦‚æœå‘½åç‚ºå…¶ä»–åç¨±ï¼šåœ¨ Thonny Shell ä¸­åŸ·è¡Œï¼š
     ```python
     import all_in_one
     ```

---

### æ–¹æ³• 2ï¼šä½¿ç”¨ ampyï¼ˆå‘½ä»¤åˆ—å·¥å…·ï¼‰

```powershell
# å®‰è£ ampyï¼ˆåªéœ€ä¸€æ¬¡ï¼‰
pip install adafruit-ampy

# ä¸Šå‚³æª”æ¡ˆåˆ° Pico W
ampy --port COM3 put all_in_one.py main.py

# é‡æ–°å•Ÿå‹• Pico W
# æŒ‰ Pico W ä¸Šçš„ BOOTSEL æŒ‰éˆ•ï¼Œæˆ–æ‹”æ‰é‡æ’
```

---

### æ–¹æ³• 3ï¼šä½¿ç”¨ rshell

```powershell
# å®‰è£ rshellï¼ˆåªéœ€ä¸€æ¬¡ï¼‰
pip install rshell

# é€£æ¥åˆ° Pico W
rshell -p COM3

# è¤‡è£½æª”æ¡ˆ
/your/path> cp all_in_one.py /pyboard/main.py

# é€€å‡ºä¸¦é‡æ–°å•Ÿå‹•
/your/path> repl
# æŒ‰ Ctrl+D é‡æ–°å•Ÿå‹•
```

---

## âš™ï¸ ä¾è³´åº«

### å¿…é ˆå®‰è£çš„åº«ï¼š

1. **max30102** - MAX30102 å¿ƒç‡æ„Ÿæ‡‰å™¨é©…å‹•
   
   ä½¿ç”¨ Thonny å®‰è£ï¼š
   - å·¥å…· â†’ ç®¡ç†å¥—ä»¶ â†’ æœå°‹ "max30102"
   - å®‰è£ `micropython-max30102`

   æˆ–ä½¿ç”¨ mpremoteï¼š
   ```powershell
   mpremote mip install max30102
   ```

   æˆ–æ‰‹å‹•ä¸‹è¼‰ï¼š
   - å¾ https://github.com/n-elia/MAX30102-MicroPython-driver
   - ä¸‹è¼‰ `max30102.py` å’Œ `circular_buffer.py`
   - ä¸Šå‚³åˆ° Pico W

### å…§å»ºåº«ï¼ˆç„¡éœ€å®‰è£ï¼‰ï¼š
- `machine` - ç¡¬é«”æ§åˆ¶
- `time`, `utime` - æ™‚é–“å‡½æ•¸
- `dht` - DHT22 æ„Ÿæ‡‰å™¨

---

## ğŸ”Œ ç¡¬é«”é€£æ¥

### è…³ä½é…ç½®ï¼ˆåœ¨æª”æ¡ˆä¸­å·²å®šç¾©ï¼‰ï¼š

```python
# ECG (AD8232)
AD8232_OUT = 28      # ADC2
AD8232_LOP = 19      # Lead-off Plus
AD8232_LON = 18      # Lead-off Minus

# GSR & EMG
GSR_SIG = 26         # ADC0
MYO_SIG = 27         # ADC1

# DHT22
DHT_PIN = 21         # GPIO21

# MAX30102 (Heart Rate / SpO2) - SoftI2C
MX30102_SDA = 16     # GPIO16
MX30102_SCL = 17     # GPIO17

# MAX30205 (Body Temp) - Hardware I2C0
MX30205_SDA = 4      # GPIO4 (I2C0 SDA)
MX30205_SCL = 5      # GPIO5 (I2C0 SCL)

# UART (USBé€£æ¥åˆ°é›»è…¦)
UART TX = 0          # GPIO0
UART RX = 1          # GPIO1
```

---

## ğŸ“Š è¼¸å‡ºæ ¼å¼

### UART è¼¸å‡ºï¼ˆ115200 baudï¼‰ï¼š

```json
{
  "ecg_value": 32768,
  "gsr_value": 15234,
  "muscle_value": 1024,
  "muscle_ok": true,
  "muscle_voltage": 0.512,
  "muscle_reason": "ok",
  "env_temperature": 25.50,
  "env_humidity": 60.00,
  "body_temperature": 36.80,
  "body_temp_fresh": true,
  "hr_value": 75,
  "spo2_value": 98,
  "ir_value": 45000,
  "lead_off_plus": false,
  "lead_off_minus": false,
  "lead_off": false
}
```

### è¼¸å‡ºé »ç‡ï¼š
- **ä¸»å¾ªç’°ï¼š10 Hz**ï¼ˆæ¯ 100ms ä¸€ç­†ï¼‰
- ä½†å„æ„Ÿæ‡‰å™¨ä»¥ä¸åŒé »ç‡æ›´æ–°ï¼ˆè¦‹ä¸‹è¡¨ï¼‰

---

## âš¡ æ„Ÿæ‡‰å™¨æ›´æ–°é »ç‡

| æ„Ÿæ‡‰å™¨ | æ›´æ–°é–“éš” | é »ç‡ | èªªæ˜ |
|--------|----------|------|------|
| ECG | 100 ms | 10 Hz | å¿ƒé›»æ³¢å½¢éœ€é«˜æ¡æ¨£ç‡ |
| GSR | 100 ms | 10 Hz | çš®è†šé›»å°ä¸­é€Ÿè®ŠåŒ– |
| Myoware | 100 ms | 10 Hz | è‚Œè‚‰æ´»å‹•å¿«é€Ÿè®ŠåŒ– |
| DHT22 | 2000 ms | 0.5 Hz | æº«æ¿•åº¦æ…¢é€Ÿè®ŠåŒ– + æ„Ÿæ‡‰å™¨é™åˆ¶ |
| MAX30205 | 1000 ms | 1 Hz | é«”æº«æ…¢é€Ÿè®ŠåŒ– |
| MAX30102 | 100 ms | 10 Hz | FIFO æŒçºŒè™•ç†ï¼ŒHR æ¯ 2 ç§’è¨ˆç®— |

**å„ªé»ï¼š**
- âœ… æ¸›å°‘ä¸å¿…è¦çš„æ„Ÿæ‡‰å™¨è®€å–ï¼ˆçœé›»ï¼‰
- âœ… ç¶­æŒ 10Hz çµ±ä¸€è¼¸å‡ºé »ç‡
- âœ… æ¯æ¬¡è¼¸å‡ºéƒ½æœ‰å®Œæ•´æ•¸æ“š

---

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### 1. åŸºæœ¬é€£æ¥æ¸¬è©¦

```python
# åœ¨ Thonny Shell æˆ– REPL ä¸­
import all_in_one

# æŸ¥çœ‹åˆå§‹åŒ–è¨Šæ¯
# æ‡‰è©²çœ‹åˆ°ï¼š
# Initializing sensors...
# MAX30102 sensor initialized successfully.
# All sensors initialized successfully!
```

### 2. é‹è¡Œå®Œæ•´ç¨‹å¼

```python
# åŸ·è¡Œä¸»ç¨‹å¼
all_in_one.main()

# è§€å¯Ÿè¼¸å‡ºï¼š
# Starting sensor data acquisition...
# Initializing MAX30102 heart rate monitor...
# Please place your finger on the MAX30102 sensor now.
#   Collecting samples... 1/5 seconds
#   ...
# Initialization complete! Starting main loop...
```

### 3. æª¢æŸ¥å„æ„Ÿæ‡‰å™¨

**ECG (AD8232):**
- è²¼ä¸Šä¸‰å€‹é›»æ¥µç‰‡
- `ecg_value` æ‡‰è©²åœ¨ 0-65535 ç¯„åœ
- `lead_off` æ‡‰è©²æ˜¯ `false`

**GSR:**
- æ‰‹æŒ‡æ¥è§¸å…©å€‹é‡‘å±¬ç‰‡
- `gsr_value` æ‡‰è©² > 0

**Myoware (EMG):**
- è²¼ä¸Šä¸‰å€‹é›»æ¥µç‰‡åœ¨è‚Œè‚‰ä¸Š
- æ”¶ç¸®è‚Œè‚‰æ™‚ `muscle_value` æ‡‰è©²å¢åŠ 
- `muscle_ok` æ‡‰è©²æ˜¯ `true`

**DHT22:**
- `env_temperature` å’Œ `env_humidity` æ‡‰è©²æœ‰åˆç†å€¼
- å®¤æº«ç´„ 20-30Â°Cï¼Œæ¿•åº¦ç´„ 30-70%

**MAX30205:**
- `body_temperature` æ‡‰è©²æ¥è¿‘ 36-37Â°C
- `body_temp_fresh` æ‡‰è©²æ˜¯ `true`

**MAX30102:**
- æ‰‹æŒ‡**å®Œå…¨è¦†è“‹**æ„Ÿæ‡‰å™¨
- ç­‰å¾… 3-5 ç§’
- `ir_value` æ‡‰è©² > 10000
- `hr_value` æ‡‰è©²åœ¨ 60-100 ç¯„åœï¼ˆæ­£å¸¸å¿ƒç‡ï¼‰

---

## ğŸ”§ è‡ªå®šç¾©é…ç½®

### ä¿®æ”¹è…³ä½

åœ¨ `SensorManager.__init__()` ä¸­ä¿®æ”¹ï¼š

```python
# ä¾‹å¦‚ï¼šæ”¹è®Š ECG è¼¸å‡ºè…³ä½
AD8232_OUT = 26  # å¾ 28 æ”¹ç‚º 26
```

### ä¿®æ”¹æ›´æ–°é »ç‡

åœ¨ `SensorManager.__init__()` ä¸­ä¿®æ”¹ `update_intervals`ï¼š

```python
self.update_intervals = {
    'ecg': 50,        # æ”¹æˆ 20 Hz
    'dht': 5000,      # æ”¹æˆæ¯ 5 ç§’
    # ...
}
```

### ä¿®æ”¹ UART æ³¢ç‰¹ç‡

```python
self.uart = UART(0, baudrate=9600, tx=Pin(0), rx=Pin(1))  # æ”¹æˆ 9600
```

---

## ğŸ› æ•…éšœæ’é™¤

### å•é¡Œ 1ï¼š`ImportError: no module named 'max30102'`

**è§£æ±ºï¼š**
```python
# ä½¿ç”¨ Thonny å®‰è£
# å·¥å…· â†’ ç®¡ç†å¥—ä»¶ â†’ æœå°‹ "max30102" â†’ å®‰è£

# æˆ–ä½¿ç”¨ mpremote
mpremote mip install max30102
```

### å•é¡Œ 2ï¼šå¿ƒç‡ä¸€ç›´æ˜¯ 0

**å¯èƒ½åŸå› ï¼š**
- æ‰‹æŒ‡æœªæ”¾åœ¨ MAX30102 ä¸Š
- IR å€¼ < 10000ï¼ˆè¨Šè™Ÿå¤ªå¼±ï¼‰
- ç­‰å¾…æ™‚é–“ä¸è¶³ï¼ˆéœ€è¦ 3-5 ç§’ï¼‰

**è§£æ±ºï¼š**
- ç¢ºä¿æ‰‹æŒ‡**å®Œå…¨è¦†è“‹**æ„Ÿæ‡‰å™¨
- ä¿æŒç©©å®šï¼Œä¸è¦ç§»å‹•
- ç­‰å¾…è‡³å°‘ 5 ç§’

### å•é¡Œ 3ï¼šDHT22 è®€æ•¸ç‚º 0

**å¯èƒ½åŸå› ï¼š**
- æ„Ÿæ‡‰å™¨é€£æ¥ä¸è‰¯
- è…³ä½éŒ¯èª¤
- æ„Ÿæ‡‰å™¨æå£

**è§£æ±ºï¼š**
- æª¢æŸ¥æ¥ç·šï¼ˆVCC, GND, DATAï¼‰
- ç¢ºèª DHT_PIN è¨­å®šæ­£ç¢º
- æ›´æ› DHT22 æ„Ÿæ‡‰å™¨

### å•é¡Œ 4ï¼šUART ç„¡è¼¸å‡º

**è§£æ±ºï¼š**
- æª¢æŸ¥åºåˆ—åŸ é€£æ¥ï¼ˆThonny æˆ–å…¶ä»–çµ‚ç«¯ï¼‰
- ç¢ºèªæ³¢ç‰¹ç‡è¨­å®šç‚º 115200
- ç¢ºèªæ²’æœ‰å…¶ä»–ç¨‹å¼ä½”ç”¨åºåˆ—åŸ 

### å•é¡Œ 5ï¼šI2C æ„Ÿæ‡‰å™¨ç„¡æ³•é€£æ¥

**è§£æ±ºï¼š**
```python
# åœ¨ REPL ä¸­æƒæ I2C è£ç½®
from machine import I2C, Pin

# ç¡¬é«” I2C0
i2c0 = I2C(0, scl=Pin(5), sda=Pin(4), freq=50000)
print("I2C0 devices:", [hex(a) for a in i2c0.scan()])

# è»Ÿé«” I2C
from machine import SoftI2C
i2c_soft = SoftI2C(scl=Pin(17), sda=Pin(16), freq=400000)
print("SoftI2C devices:", [hex(a) for a in i2c_soft.scan()])
```

é æœŸçœ‹åˆ°ï¼š
- MAX30205: `0x48` - `0x4f` ä¹‹ä¸€
- MAX30102: `0x57`

---

## ğŸ“ èª¿è©¦æŠ€å·§

### 1. æŸ¥çœ‹åˆå§‹åŒ–è¨Šæ¯

```python
all_in_one.main()
# è§€å¯Ÿæ˜¯å¦æ‰€æœ‰æ„Ÿæ‡‰å™¨éƒ½æˆåŠŸåˆå§‹åŒ–
```

### 2. å–®ç¨æ¸¬è©¦æ„Ÿæ‡‰å™¨

```python
from machine import Pin, ADC

# æ¸¬è©¦ ECG
ecg_adc = ADC(Pin(28))
print("ECG value:", ecg_adc.read_u16())

# æ¸¬è©¦ GSR
gsr_adc = ADC(Pin(26))
print("GSR value:", gsr_adc.read_u16())
```

### 3. æŸ¥çœ‹ MAX30102 èª¿è©¦è¨Šæ¯

åœ¨ä¸»å¾ªç’°é‹è¡Œæ™‚ï¼Œæ‡‰è©²æ¯ 2 ç§’çœ‹åˆ°ï¼š
```
[MAX30102] Samples: 150, Calculated HR: 75, Current HR: 75, IR: 45000
  âœ“ Valid HR updated: 75 BPM
```

---

## ğŸ“‚ æª”æ¡ˆæ¯”è¼ƒ

### å–®æª”æ¡ˆç‰ˆæœ¬ vs æ¨¡çµ„åŒ–ç‰ˆæœ¬

| ç‰¹æ€§ | all_in_one.py | æ¨¡çµ„åŒ–ç‰ˆæœ¬ |
|------|---------------|------------|
| **æª”æ¡ˆæ•¸é‡** | 1 å€‹ | 11+ å€‹ |
| **éƒ¨ç½²** | âœ… ç°¡å–®ï¼ˆè¤‡è£½ä¸€å€‹æª”æ¡ˆï¼‰ | âŒ è¤‡é›œï¼ˆéœ€è¤‡è£½æ•´å€‹è³‡æ–™å¤¾ï¼‰ |
| **ç¶­è­·** | âŒ è¼ƒé›£ï¼ˆæ‰€æœ‰ä»£ç¢¼åœ¨ä¸€èµ·ï¼‰ | âœ… å®¹æ˜“ï¼ˆåˆ†é–‹ç®¡ç†ï¼‰ |
| **æ¸¬è©¦** | âŒ è¼ƒé›£ï¼ˆç„¡æ³•å–®ç¨æ¸¬è©¦ï¼‰ | âœ… å®¹æ˜“ï¼ˆæ¯å€‹æ„Ÿæ‡‰å™¨ç¨ç«‹ï¼‰ |
| **å¤§å°** | ~800 è¡Œ | æ¯å€‹æª”æ¡ˆ 50-150 è¡Œ |
| **é©ç”¨å ´æ™¯** | å¿«é€Ÿéƒ¨ç½²ã€å–®ä¸€è£ç½® | é–‹ç™¼ã€å¤šäººå”ä½œ |

**å»ºè­°ï¼š**
- ğŸš€ **å¿«é€Ÿæ¸¬è©¦/å–®ä¸€è£ç½®**ï¼šä½¿ç”¨ `all_in_one.py`
- ğŸ› ï¸ **é–‹ç™¼/ç¶­è­·**ï¼šä½¿ç”¨æ¨¡çµ„åŒ–ç‰ˆæœ¬ï¼ˆsensors/ è³‡æ–™å¤¾ï¼‰

---

## ğŸ¯ å¿«é€Ÿé–‹å§‹æª¢æŸ¥æ¸…å–®

- [ ] å®‰è£ Thonny æˆ–å…¶ä»– MicroPython IDE
- [ ] é€£æ¥ Pico W åˆ°é›»è…¦
- [ ] å®‰è£ `max30102` åº«
- [ ] ä¸Šå‚³ `all_in_one.py` ç‚º `main.py`
- [ ] é€£æ¥æ‰€æœ‰æ„Ÿæ‡‰å™¨åˆ°æ­£ç¢ºè…³ä½
- [ ] é‡æ–°å•Ÿå‹• Pico W
- [ ] æ‰“é–‹åºåˆ—åŸ ç›£è¦–å™¨ï¼ˆ115200 baudï¼‰
- [ ] è§€å¯Ÿ JSON è¼¸å‡º
- [ ] æ¸¬è©¦å„æ„Ÿæ‡‰å™¨åŠŸèƒ½

---

## ğŸ“ æ”¯æ´

å¦‚æœ‰å•é¡Œï¼Œè«‹æª¢æŸ¥ï¼š

1. **ç¡¬é«”é€£æ¥**ï¼šè…³ä½æ˜¯å¦æ­£ç¢º
2. **åº«ä¾è³´**ï¼š`max30102` æ˜¯å¦å·²å®‰è£
3. **æ„Ÿæ‡‰å™¨ç‹€æ…‹**ï¼šæ˜¯å¦æ­£ç¢ºé€£æ¥å’Œä¾›é›»
4. **èª¿è©¦è¨Šæ¯**ï¼šæŸ¥çœ‹çµ‚ç«¯è¼¸å‡ºçš„éŒ¯èª¤è¨Šæ¯

---

## ğŸ“„ æˆæ¬Š

æ­¤ç¨‹å¼ç¢¼ç‚º AI Assistant ç”Ÿæˆï¼Œä¾›æ•™è‚²å’Œç ”ç©¶ä½¿ç”¨ã€‚

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰
